<%

# local variables
#
#   execution (TestExecution)

%>

<% return unless execution %>
<% c3_execution = execution.sibling_execution %>

<table class = 'table table-hover table-condensed'>
  <thead>
    <th class = 'no-wrap' scope = 'col'>
      Upload Results
    </th>
    <th class = 'no-wrap' scope = 'col'>C1 Upload Results</th>
    <% if c3_execution %>
      <th class = 'no-wrap' scope = 'col'>C3 Upload Results</th>
    <% end %>
    <th class = 'no-wrap' scope = 'col'>Status</th>
  </thead>
  <tbody>
    <tr>
      <td><%= link_to 'View Results', new_task_test_execution_path(execution.task) %></td>
      <% # for both c1 and c3 executions (if they exist) %>
      <% [execution, c3_execution].compact.each do |exec| %>
        <td>
          <% case exec.status %>
          <% when 'passing' %>
            <strong class = 'text-success'>Passing</strong>
          <% when 'failing' %>
            <strong class = 'text-danger'><%= "Failing with #{exec.execution_errors.count} errors" %></strong>
          <% else %>
            <strong class = 'text-info'>In Progress</strong>
          <% end %>
        </td>
      <% end %>
      <td>
        <% case execution.status_with_sibling %>
        <% when 'passing' %>
          <strong class = 'text-success'>Passing</strong>
        <% when 'failing' %>
          <strong class = 'text-danger'>Failing</strong>
        <% else %>
          <strong class = 'text-info'>In Progress</strong>
        <% end %>
      </td>
    </tr>
  </tbody>
</table>

<% if execution.executions_pending? %>
  <script>
    $.ajax({url: "<%= request.env['PATH_INFO'] %>", type: "GET", dataType: 'script', data: { partial: 'checklist_execution_results', test_execution_id: "<%= execution.id.to_s %>" }});
  </script>
<% end %>
